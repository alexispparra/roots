
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /projects/{projectId} {

      // CREATE: Allow any authenticated user to create a project.
      // The app's logic ensures the creator becomes the owner and admin.
      allow create: if request.auth != null;

      // READ, UPDATE: Allow if the user is a participant in the project.
      // The app's UI enforces finer-grained permissions (e.g., admin vs. editor).
      allow read, update: if request.auth != null && 
                             request.auth.token.email in resource.data.participantsEmails;

      // DELETE: Allow only if the user is the original owner of the project.
      allow delete: if request.auth != null &&
                       request.auth.token.email == resource.data.ownerEmail;
    }
  }
}
