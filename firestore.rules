rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- Projects Collection ---
    match /projects/{projectId} {
      // Only participants can read or write to a project.
      allow read, write: if request.auth != null && request.auth.token.email in resource.data.participantsEmails;
    }
    
    // --- Users Collection ---
    match /users/{userId} {
      // The ADMIN can do anything with any user document.
      // The 'read' permission includes 'get' and 'list'.
      // This rule is evaluated first for the admin.
      allow read, write: if request.auth.token.email == 'alexispparra@gmail.com';
      
      // A non-admin user can:
      // 1. Get their own document.
      allow get: if request.auth != null && request.auth.uid == userId;
      // 2. Create their own document upon registration.
      allow create: if request.auth != null && request.auth.uid == userId;
      // 3. Update their own document.
      allow update: if request.auth != null && request.auth.uid == userId;
    }
  }
}
