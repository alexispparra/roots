rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      // Esta función sigue aquí para que el resto del código no falle, pero no se usará en la regla de prueba.
      return request.auth != null && request.auth.token.email == 'alexispparra@gmail.com';
    }

    // --- PROYECTOS ---
    match /projects/{projectId} {
      function isParticipant() {
        return request.auth != null && request.auth.token.email in resource.data.participantsEmails;
      }
      // Mantenemos la seguridad de los proyectos.
      allow read, write: if isParticipant();
    }

    // --- USUARIOS ---
    match /users/{userId} {
      // REGLA DE DIAGNÓSTICO TEMPORAL E INSEGURA:
      // Permite a CUALQUIER usuario autenticado leer (incluyendo listar) y escribir.
      // Esto es para verificar si la conexión y la consulta son correctas,
      // aislando el problema de la condición `isAdmin()`.
      allow read, write: if request.auth != null;
    }
  }
}
