
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- Reglas para Perfiles de Usuario ---
    match /users/{userId} {
      // Un usuario solo puede leer y escribir su propio perfil.
      allow read, write: if request.auth.uid == userId;
      
      // El administrador principal de la app (definido en el c√≥digo) puede listar y leer todos los perfiles.
      allow list, get: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.email == "alexispparra@gmail.com";
    }
    
    // --- Reglas para Proyectos ---
    match /projects/{projectId} {
      // Un usuario solo puede leer o escribir en un proyecto si es un participante.
      allow read, write: if request.auth.token.email in resource.data.participantsEmails;
      
      // Cualquier usuario autenticado puede crear un proyecto nuevo.
      allow create: if request.auth != null;
    }
    
    // --- Reglas para Proveedores ---
    match /suppliers/{supplierId} {
      // Cualquier usuario autenticado puede leer y escribir en la lista global de proveedores.
      allow read, write: if request.auth != null;
    }
  }
}
